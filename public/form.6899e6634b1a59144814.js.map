{"version":3,"sources":["webpack:///./app/api/tag.js","webpack:///./app/api/topic.js","webpack:///./app/component/topic-form/index.jsx","webpack:///./app/component/topic-form/topic-form.scss?20b3","webpack:///./app/container/form.jsx","webpack:///./common/validate.js","webpack:///./common/validation/topic.js"],"names":["_type","__webpack_require__","_api","Api","list","url","actionType","LOAD_TAG_LIST","view","LOAD_TAG_DETAIL","topicList","LOAD_TAG_TOPIC_LIST","create","method","CREATE_TOPIC","update","UPDATE_TOPIC","LOAD_TOPIC_LIST","LOAD_TOPIC_DETAIL","comments","LOAD_COMMENT_LIST","addComment","ADD_COMMENT","stick","STICK_TOPIC","_react","_validate2","TopicForm","props","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","state","errors","formData","title","content","tags","newTags","inputed","PureComponent","nextProps","prevState","topic","map","t","id","e","_e$target","target","name","value","targetValue","validateFieldName","split","setState","nextFormData","_defineProperty","valRet","validateField","rules","error","_validate","_validate3","default","isValid","onSave","undefined","_classnames2","form-control","is-valid","is-invalid","tag","indexOf","preventDefault","index","findIndex","tId","nextValue","concat","splice","handleFieldChange","_this2","loading","_state$formData","_react2","createElement","className","htmlFor","required","type","formControlClassName","placeholder","onChange","formControlInvalidFeedback","tagList","href","isTagSelected","key","onClick","handleSelectTag","join","disabled","handleSave","onCancel","propTypes","PropTypes","func","bool","array","defaultProps","module","i","options","hmr","transform","locals","exports","_reactRedux","Form","tagApi","isEditing","fetchTopic","prevProps","topicId","parseInt","match","params","_props","topicLoading","topicApi","data","then","toTopicDetail","toHome","history","push","_this3","_props2","topicSaveLoading","_topicForm2","handleSaveTopic","handleCancel","connect","validatorList","ret","keys","forEach","field","fieldValRet","fieldRules","arguments","length","_ref","validator","extraArgs","_ref$reverse","reverse","_ref$message","message","isCustom","validatorFunc","Error","validatorArgs","Array","isArray","_toConsumableArray","min","max","userId"],"mappings":"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","file":"form.6899e6634b1a59144814.js","sourcesContent":["import { LOAD_TAG_LIST, LOAD_TAG_TOPIC_LIST, LOAD_TAG_DETAIL } from '../redux/type'\nimport Api from './api'\n\nexport default new Api({\n    list: {\n        url: '/api/tag',\n        actionType: LOAD_TAG_LIST\n    },\n    view: {\n        url: '/api/tag/:id',\n        actionType: LOAD_TAG_DETAIL\n    },\n    topicList: {\n        url: '/api/tag/:id/topic',\n        actionType: LOAD_TAG_TOPIC_LIST\n    }\n})\n","import { CREATE_TOPIC, UPDATE_TOPIC, STICK_TOPIC, LOAD_TOPIC_LIST, LOAD_TOPIC_DETAIL, LOAD_COMMENT_LIST, ADD_COMMENT } from '../redux/type'\nimport Api from './api'\n\nexport default new Api({\n    create: {\n        url: '/api/topic',\n        method: 'post',\n        actionType: CREATE_TOPIC\n    },\n    update: {\n        url: '/api/topic/:id',\n        method: 'put',\n        actionType: UPDATE_TOPIC\n    },\n    list: {\n        url: '/api/topic',\n        actionType: LOAD_TOPIC_LIST\n    },\n    view: {\n        url: '/api/topic/:id',\n        actionType: LOAD_TOPIC_DETAIL\n    },\n    comments: {\n        url: '/api/topic/:id/comment',\n        actionType: LOAD_COMMENT_LIST\n    },\n    addComment: {\n        method: 'post',\n        url: '/api/topic/:id/comment',\n        actionType: ADD_COMMENT\n    },\n    stick: {\n        method: 'post',\n        url: '/api/topic/:id/stick',\n        actionType: STICK_TOPIC\n    }\n})\n","import React, { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport classnames from 'classnames'\nimport validate, { validateField } from '../../../common/validate'\nimport rules from '../../../common/validation/topic'\nimport './topic-form.scss'\n\nexport default class TopicForm extends PureComponent {\n    static getDerivedStateFromProps (nextProps, prevState) {\n        const { topic } = nextProps\n        const { inputed } = prevState\n        if (inputed || !topic) return null\n        return {\n            formData: {\n                title: topic.title,\n                content: topic.content,\n                tags: topic.tags.map(t => t.id),\n                newTags: []\n            }\n        }\n    }\n    constructor (props) {\n        super(props)\n        this.state = {\n            errors: {},\n            formData: {\n                title: '',\n                content: '',\n                tags: [],\n                newTags: []\n            },\n            inputed: false\n        }\n    }\n    handleFieldChange (e) {\n        const { name, value } = e.target\n        let targetValue = value\n        let validateFieldName = name\n        if (name === 'newTags') {\n            targetValue = value ? value.split(',') : []\n            validateFieldName = 'tags'\n        }\n        this.setState(prevState => {\n            const nextFormData = {\n                ...prevState.formData,\n                [name]: targetValue\n            }\n            const valRet = validateField(nextFormData[validateFieldName], rules[validateFieldName], nextFormData)\n            return {\n                formData: nextFormData,\n                errors: {\n                    ...prevState.errors,\n                    [validateFieldName]: valRet.error\n                },\n                inputed: true\n            }\n        })\n    }\n    handleSave () {\n        const { formData } = this.state\n        const { isValid, errors } = validate(formData, rules)\n        if (!isValid) {\n            this.setState({ errors })\n            return\n        }\n        this.props.onSave(formData)\n    }\n    formControlClassName (name) {\n        const { errors } = this.state\n        if (errors[name] === undefined) return 'form-control'\n        const isValid = !errors[name]\n        return classnames({\n            'form-control': true,\n            'is-valid': isValid,\n            'is-invalid': !isValid\n        })\n    }\n    formControlInvalidFeedback (name) {\n        return this.state.errors[name]\n    }\n    isTagSelected (tag) {\n        return this.state.formData.tags.indexOf(tag.id) !== -1\n    }\n    handleSelectTag (e, tag) {\n        e.preventDefault()\n        const { tags } = this.state.formData\n        const index = tags.findIndex(tId => tId === tag.id)\n        let nextValue = []\n        if (index === -1) {\n            nextValue = tags.concat(tag.id)\n        } else {\n            nextValue = [...tags]\n            nextValue.splice(index, 1)\n        }\n        this.handleFieldChange({\n            target: {\n                name: 'tags',\n                value: nextValue\n            }\n        })\n    }\n    render () {\n        const { loading } = this.props\n        const { title, content, newTags } = this.state.formData\n        return (\n            <div className=\"card topic-form\">\n                <div className=\"card-body\">\n                    <div className=\"form-group\">\n                        <label htmlFor=\"topic-title\">标题</label>\n                        <input\n                            required\n                            type=\"text\"\n                            className={this.formControlClassName('title')}\n                            id=\"topic-title\"\n                            placeholder=\"请输入标题\"\n                            name=\"title\"\n                            value={title}\n                            onChange={e => this.handleFieldChange(e)}\n                        />\n                        <div className=\"invalid-feedback\">{this.formControlInvalidFeedback('title')}</div>\n                        <small className=\"form-text text-muted\">请用尽量简单概括的一句话来作为你要发表的内容的标题</small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"topic-content\">内容</label>\n                        <textarea\n                            required\n                            className={this.formControlClassName('content')}\n                            id=\"topic-content\"\n                            placeholder=\"请输入主题内容\"\n                            name=\"content\"\n                            value={content}\n                            onChange={e => this.handleFieldChange(e)}\n                        />\n                        <div className=\"invalid-feedback\">{this.formControlInvalidFeedback('content')}</div>\n                        <small className=\"form-text text-muted\">主题内容支持 Markdown 语法，作为一个靠谱的程序员，请让你发表的内容像你写的代码一样清晰。</small>\n                    </div>\n                    <div className=\"form-group\">\n                        <label htmlFor=\"topic-tags\">标签</label>\n                        <div className=\"mb-3\">\n                            {\n                                this.props.tagList.map(tag => (\n                                    <a\n                                        href=\"#\"\n                                        className={`badge badge-${this.isTagSelected(tag) ? 'success' : 'primary'} mr-1`}\n                                        key={tag.id}\n                                        onClick={e => this.handleSelectTag(e, tag)}\n                                    >{tag.name}</a>\n                                ))\n                            }\n                        </div>\n                        <input\n                            required\n                            type=\"text\"\n                            className={this.formControlClassName('tags')}\n                            id=\"topic-tags\"\n                            placeholder=\"请设置标签\"\n                            name=\"newTags\"\n                            value={newTags.join(',')}\n                            onChange={e => this.handleFieldChange(e)}\n                        />\n                        <div className=\"invalid-feedback\">{this.formControlInvalidFeedback('tags')}</div>\n                        <small className=\"form-text text-muted\">为便于更容易被别人看到，请为主题设置准确的标签，多个标签请以逗号分隔。</small>\n                    </div>\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-primary\"\n                        disabled={loading}\n                        onClick={() => this.handleSave()}\n                    >\n                        { loading ? '正在提交...' : '提 交' }\n                    </button>\n                    <button\n                        type=\"button\"\n                        className=\"btn btn-link\"\n                        onClick={() => this.props.onCancel()}\n                    >\n                        取消\n                    </button>\n                </div>\n            </div>\n        )\n    }\n}\n\nTopicForm.propTypes = {\n    onSave: PropTypes.func,\n    onCancel: PropTypes.func,\n    loading: PropTypes.bool,\n    tagList: PropTypes.array\n}\n\nTopicForm.defaultProps = {\n    onSave: () => null,\n    onCancel: () => null,\n    loading: false,\n    tagList: []\n}\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--6-2!../../../node_modules/sass-loader/lib/loader.js!./topic-form.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":true}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--6-2!../../../node_modules/sass-loader/lib/loader.js!./topic-form.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/index.js??ref--6-2!../../../node_modules/sass-loader/lib/loader.js!./topic-form.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import React, { PureComponent } from 'react'\nimport { connect } from 'react-redux'\n\nimport topicApi from '../api/topic'\nimport tagApi from '../api/tag'\n\nimport TopicForm from '../component/topic-form'\n\nclass Form extends PureComponent {\n    componentDidMount () {\n        tagApi.list()\n        if (this.isEditing()) {\n            this.fetchTopic()\n        }\n    }\n    componentDidUpdate (prevProps, prevState) {\n        if (!this.isEditing()) return\n        const topicId = parseInt(this.props.match.params.id, 10)\n        const { topic, topicLoading } = this.props\n        if (!topicLoading && (!topic || topicId !== topic.id)) {\n            this.fetchTopic()\n        }\n    }\n    handleSaveTopic (topic) {\n        if (this.isEditing()) {\n            topicApi\n                .update({\n                    params: { id: this.props.match.params.id },\n                    data: topic\n                })\n                .then(() => this.toTopicDetail())\n            return\n        }\n        topicApi\n            .create({\n                data: topic\n            })\n            .then(() => this.toHome())\n    }\n    handleCancel () {\n        if (this.isEditing()) {\n            this.toTopicDetail()\n        } else {\n            this.toHome()\n        }\n    }\n    fetchTopic () {\n        const topicId = parseInt(this.props.match.params.id, 10)\n        topicApi.view({\n            params: {\n                id: topicId\n            }\n        }, { topicId })\n    }\n    isEditing () {\n        return !!this.props.match.params.id\n    }\n    toHome () {\n        this.props.history.push('/')\n    }\n    toTopicDetail () {\n        const { id } = this.props.match.params\n        if (!id) return\n        this.props.history.push(`/topic/${id}`)\n    }\n    render () {\n        const { topicSaveLoading, tagList, topic } = this.props\n        return (\n            <div className=\"container mt-4\">\n                <div className=\"row\">\n                    <div className=\"col-12\">\n                        <TopicForm\n                            loading={topicSaveLoading}\n                            tagList={tagList}\n                            topic={topic}\n                            isEditing={this.isEditing()}\n                            onSave={topic => this.handleSaveTopic(topic)}\n                            onCancel={() => this.handleCancel()}\n                        />\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default connect(state => state)(Form)\n","const validatorList = require('validator')\n\n/**\n *\n * @param {Object} data\n * @param {Object} rules {\n *      someField: [\n *          {\n *              validator: 'isLength',\n *              reverse: false,\n *              message: '',\n *              extraArgs: {}\n *          }\n *      ]\n * }\n * @param {*} messages\n */\nmodule.exports = function validate (data, rules) {\n    const ret = { isValid: true, data: null, errors: null }\n    if (!rules) return ret\n    const safeFields = Object.keys(rules)\n    safeFields.forEach(field => {\n        const fieldValRet = module.exports.validateField(data[field], rules[field], data)\n        if (fieldValRet.isValid) {\n            if (!ret.data) ret.data = {}\n            if (data[field] !== undefined) {\n                ret.data[field] = data[field]\n            }\n        } else {\n            ret.isValid = false\n            if (!ret.errors) ret.errors = {}\n            ret.errors[field] = fieldValRet.error\n        }\n    })\n    return ret\n}\n\nmodule.exports.validateField = function (value, fieldRules, formData = null) {\n    const ret = {\n        isValid: true,\n        error: ''\n    }\n    fieldRules.forEach(({ validator, extraArgs, reverse = false, message = '' }) => {\n        if (!ret.isValid) return\n        const isCustom = typeof validator === 'function'\n        const validatorFunc = isCustom ? validator : validatorList[validator]\n        if (!validatorFunc) throw new Error(`${validator} is not a valid validator.`)\n        let validatorArgs\n        if (isCustom) {\n            validatorArgs = [formData]\n        } else {\n            if (!Array.isArray(extraArgs)) {\n                validatorArgs = [extraArgs]\n            } else {\n                validatorArgs = extraArgs\n            }\n        }\n        ret.isValid = validatorFunc(value, ...validatorArgs)\n        ret.isValid = reverse ? !ret.isValid : ret.isValid\n        if (!ret.isValid) {\n            ret.isValid = false\n            ret.error = message\n        }\n    })\n    return ret\n}\n","module.exports = {\n    title: [\n        {\n            validator: 'isEmpty',\n            reverse: true,\n            message: '请输入标题'\n        },\n        {\n            validator: 'isLength',\n            extraArgs: {\n                min: 5,\n                max: 256\n            },\n            message: '帖子标题长度需要在 5 - 256 个字符之间'\n        }\n    ],\n    content: [\n        {\n            validator: 'isEmpty',\n            reverse: true,\n            message: '请输入帖子内容'\n        },\n        {\n            validator: 'isLength',\n            extraArgs: {\n                min: 20\n            },\n            message: '帖子内容请至少输入 20 个字符'\n        }\n    ],\n    tags: [\n        {\n            validator: (value, formData) => {\n                return (Array.isArray(value) && value.length > 0) ||\n                    (Array.isArray(formData.newTags) && formData.newTags.length > 0)\n            },\n            message: '请为主题设置一个标签'\n        }\n    ],\n    newTags: [\n        {\n            validator: Array.isArray,\n            message: '不合法的参数 newTags'\n        }\n    ],\n    userId: [\n        {\n            validator: () => true\n        }\n    ],\n    id: [\n        {\n            validator: () => true\n        }\n    ]\n}\n"],"sourceRoot":""}