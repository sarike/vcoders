(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"./app/api/tag.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a("./app/redux/type.js"),o=a("./app/api/api.js"),i=(n=o)&&n.__esModule?n:{default:n};t.default=new i.default({list:{url:"/api/tag",actionType:r.LOAD_TAG_LIST},view:{url:"/api/tag/:id",actionType:r.LOAD_TAG_DETAIL},topicList:{url:"/api/tag/:id/topic",actionType:r.LOAD_TAG_TOPIC_LIST}})},"./app/api/topic.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a("./app/redux/type.js"),o=a("./app/api/api.js"),i=(n=o)&&n.__esModule?n:{default:n};t.default=new i.default({create:{url:"/api/topic",method:"post",actionType:r.CREATE_TOPIC},update:{url:"/api/topic/:id",method:"put",actionType:r.UPDATE_TOPIC},list:{url:"/api/topic",actionType:r.LOAD_TOPIC_LIST},view:{url:"/api/topic/:id",actionType:r.LOAD_TOPIC_DETAIL},comments:{url:"/api/topic/:id/comment",actionType:r.LOAD_COMMENT_LIST},addComment:{method:"post",url:"/api/topic/:id/comment",actionType:r.ADD_COMMENT},stick:{method:"post",url:"/api/topic/:id/stick",actionType:r.STICK_TOPIC}})},"./app/component/topic-form/index.jsx":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),o=a("./node_modules/react/index.js"),i=p(o),s=p(a("./node_modules/prop-types/index.js")),l=p(a("./node_modules/classnames/index.js")),c=a("./common/validate.js"),u=p(c),d=p(a("./common/validation/topic.js"));function p(e){return e&&e.__esModule?e:{default:e}}function f(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a("./app/component/topic-form/topic-form.scss");var m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={errors:{},formData:{title:"",content:"",tags:[],newTags:[]},inputed:!1},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.PureComponent),r(t,null,[{key:"getDerivedStateFromProps",value:function(e,t){var a=e.topic;return t.inputed||!a?null:{formData:{title:a.title,content:a.content,tags:a.tags.map(function(e){return e.id}),newTags:[]}}}}]),r(t,[{key:"handleFieldChange",value:function(e){var t=e.target,a=t.name,r=t.value,o=r,i=a;"newTags"===a&&(o=r?r.split(","):[],i="tags"),this.setState(function(e){var t=n({},e.formData,f({},a,o)),r=(0,c.validateField)(t[i],d.default[i],t);return{formData:t,errors:n({},e.errors,f({},i,r.error)),inputed:!0}})}},{key:"handleSave",value:function(){var e=this.state.formData,t=(0,u.default)(e,d.default),a=t.isValid,n=t.errors;a?this.props.onSave(e):this.setState({errors:n})}},{key:"formControlClassName",value:function(e){var t=this.state.errors;if(void 0===t[e])return"form-control";var a=!t[e];return(0,l.default)({"form-control":!0,"is-valid":a,"is-invalid":!a})}},{key:"formControlInvalidFeedback",value:function(e){return this.state.errors[e]}},{key:"isTagSelected",value:function(e){return-1!==this.state.formData.tags.indexOf(e.id)}},{key:"handleSelectTag",value:function(e,t){e.preventDefault();var a=this.state.formData.tags,n=a.findIndex(function(e){return e===t.id}),r=[];-1===n?r=a.concat(t.id):(r=[].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(a))).splice(n,1),this.handleFieldChange({target:{name:"tags",value:r}})}},{key:"render",value:function(){var e=this,t=this.props.loading,a=this.state.formData,n=a.title,r=a.content,o=a.newTags;return i.default.createElement("div",{className:"card topic-form"},i.default.createElement("div",{className:"card-body"},i.default.createElement("div",{className:"form-group"},i.default.createElement("label",{htmlFor:"topic-title"},"标题"),i.default.createElement("input",{required:!0,type:"text",className:this.formControlClassName("title"),id:"topic-title",placeholder:"请输入标题",name:"title",value:n,onChange:function(t){return e.handleFieldChange(t)}}),i.default.createElement("div",{className:"invalid-feedback"},this.formControlInvalidFeedback("title")),i.default.createElement("small",{className:"form-text text-muted"},"请用尽量简单概括的一句话来作为你要发表的内容的标题")),i.default.createElement("div",{className:"form-group"},i.default.createElement("label",{htmlFor:"topic-content"},"内容"),i.default.createElement("textarea",{required:!0,className:this.formControlClassName("content"),id:"topic-content",placeholder:"请输入主题内容",name:"content",value:r,onChange:function(t){return e.handleFieldChange(t)}}),i.default.createElement("div",{className:"invalid-feedback"},this.formControlInvalidFeedback("content")),i.default.createElement("small",{className:"form-text text-muted"},"主题内容支持 Markdown 语法，作为一个靠谱的程序员，请让你发表的内容像你写的代码一样清晰。")),i.default.createElement("div",{className:"form-group"},i.default.createElement("label",{htmlFor:"topic-tags"},"标签"),i.default.createElement("div",{className:"mb-3"},this.props.tagList.map(function(t){return i.default.createElement("a",{href:"#",className:"badge badge-"+(e.isTagSelected(t)?"success":"primary")+" mr-1",key:t.id,onClick:function(a){return e.handleSelectTag(a,t)}},t.name)})),i.default.createElement("input",{required:!0,type:"text",className:this.formControlClassName("tags"),id:"topic-tags",placeholder:"请设置标签",name:"newTags",value:o.join(","),onChange:function(t){return e.handleFieldChange(t)}}),i.default.createElement("div",{className:"invalid-feedback"},this.formControlInvalidFeedback("tags")),i.default.createElement("small",{className:"form-text text-muted"},"为便于更容易被别人看到，请为主题设置准确的标签，多个标签请以逗号分隔。")),i.default.createElement("button",{type:"button",className:"btn btn-primary",disabled:t,onClick:function(){return e.handleSave()}},t?"正在提交...":"提 交"),i.default.createElement("button",{type:"button",className:"btn btn-link",onClick:function(){return e.props.onCancel()}},"取消")))}}]),t}();t.default=m,m.propTypes={onSave:s.default.func,onCancel:s.default.func,loading:s.default.bool,tagList:s.default.array},m.defaultProps={onSave:function(){return null},onCancel:function(){return null},loading:!1,tagList:[]}},"./app/component/topic-form/topic-form.scss":function(e,t,a){var n=a("./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/index.js??ref--6-2!./node_modules/sass-loader/lib/loader.js!./app/component/topic-form/topic-form.scss");"string"==typeof n&&(n=[[e.i,n,""]]);var r={hmr:!0,transform:void 0};a("./node_modules/style-loader/lib/addStyles.js")(n,r);n.locals&&(e.exports=n.locals)},"./app/container/form.jsx":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a("./node_modules/react/index.js"),o=u(r),i=a("./node_modules/react-redux/es/index.js"),s=u(a("./app/api/topic.js")),l=u(a("./app/api/tag.js")),c=u(a("./app/component/topic-form/index.jsx"));function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),n(t,[{key:"componentDidMount",value:function(){l.default.list(),this.isEditing()&&this.fetchTopic()}},{key:"componentDidUpdate",value:function(e,t){if(this.isEditing()){var a=parseInt(this.props.match.params.id,10),n=this.props,r=n.topic;n.topicLoading||r&&a===r.id||this.fetchTopic()}}},{key:"handleSaveTopic",value:function(e){var t=this;this.isEditing()?s.default.update({params:{id:this.props.match.params.id},data:e}).then(function(){return t.toTopicDetail()}):s.default.create({data:e}).then(function(){return t.toHome()})}},{key:"handleCancel",value:function(){this.isEditing()?this.toTopicDetail():this.toHome()}},{key:"fetchTopic",value:function(){var e=parseInt(this.props.match.params.id,10);s.default.view({params:{id:e}},{topicId:e})}},{key:"isEditing",value:function(){return!!this.props.match.params.id}},{key:"toHome",value:function(){this.props.history.push("/")}},{key:"toTopicDetail",value:function(){var e=this.props.match.params.id;e&&this.props.history.push("/topic/"+e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.topicSaveLoading,n=t.tagList,r=t.topic;return o.default.createElement("div",{className:"container mt-4"},o.default.createElement("div",{className:"row"},o.default.createElement("div",{className:"col-12"},o.default.createElement(c.default,{loading:a,tagList:n,topic:r,isEditing:this.isEditing(),onSave:function(t){return e.handleSaveTopic(t)},onCancel:function(){return e.handleCancel()}}))))}}]),t}();t.default=(0,i.connect)(function(e){return e})(d)},"./common/validate.js":function(e,t,a){"use strict";var n=a("./node_modules/validator/index.js");e.exports=function(t,a){var n={isValid:!0,data:null,errors:null};return a?(Object.keys(a).forEach(function(r){var o=e.exports.validateField(t[r],a[r],t);o.isValid?(n.data||(n.data={}),void 0!==t[r]&&(n.data[r]=t[r])):(n.isValid=!1,n.errors||(n.errors={}),n.errors[r]=o.error)}),n):n},e.exports.validateField=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r={isValid:!0,error:""};return t.forEach(function(t){var o=t.validator,i=t.extraArgs,s=t.reverse,l=void 0!==s&&s,c=t.message,u=void 0===c?"":c;if(r.isValid){var d="function"==typeof o,p=d?o:n[o];if(!p)throw new Error(o+" is not a valid validator.");var f=void 0;f=d?[a]:Array.isArray(i)?i:[i],r.isValid=p.apply(void 0,[e].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(f))),r.isValid=l?!r.isValid:r.isValid,r.isValid||(r.isValid=!1,r.error=u)}}),r}},"./common/validation/topic.js":function(e,t,a){"use strict";e.exports={title:[{validator:"isEmpty",reverse:!0,message:"请输入标题"},{validator:"isLength",extraArgs:{min:5,max:256},message:"帖子标题长度需要在 5 - 256 个字符之间"}],content:[{validator:"isEmpty",reverse:!0,message:"请输入帖子内容"},{validator:"isLength",extraArgs:{min:20},message:"帖子内容请至少输入 20 个字符"}],tags:[{validator:function(e,t){return Array.isArray(e)&&e.length>0||Array.isArray(t.newTags)&&t.newTags.length>0},message:"请为主题设置一个标签"}],newTags:[{validator:Array.isArray,message:"不合法的参数 newTags"}],userId:[{validator:function(){return!0}}],id:[{validator:function(){return!0}}]}},"./node_modules/mini-css-extract-plugin/dist/loader.js!./node_modules/css-loader/index.js??ref--6-2!./node_modules/sass-loader/lib/loader.js!./app/component/topic-form/topic-form.scss":function(e,t,a){}}]);
//# sourceMappingURL=form.6899e6634b1a59144814.js.map